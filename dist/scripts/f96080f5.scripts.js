"use strict";angular.module("labsVisualizationsApp",[]),function(){window.SentimentWave=function(){function a(a,b,c,d){var e,f=this;this.parent=a,this.width=b,this.height=c,this.data=d,e=this.buildLayers(this.data),this.svg=d3.select(this.parent).append("svg").attr("width",this.width).attr("height",this.height),this.colors=["#ff6666","#aaaaaa","#66ff66"],this.svg.selectAll("path.main").data(e.layers).enter().append("path").attr({d:e.area,"class":"main"}).style("fill",function(a,b){return f.colors[b]})}return a.prototype.subwave=function(a){var b,c=this;return b=this.buildLayers(this.data,a),this.svg.selectAll("path.main").style("opacity",.2),this.svg.selectAll("path.subwave").data(b.layers).enter().append("path").attr({d:b.area,"class":"subwave"}).attr("d",b.area).attr("transform","translate(0,-"+b.offset+")").style({fill:function(a,b){return c.colors[b]},opacity:1})},a.prototype.findMax=function(a){var b,c,d,e;for(c=0,d=0,e=a.length;e>d;d++)b=a[d],null!=b&&(b.positive>c&&(c=b.positive),b.neutral>c&&(c=b.neutral),b.negative>c&&(c=b.negative));return c},a.prototype.buildWaves=function(a,b){var c,d,e;return e=[],d=[],c=[],0!==b?(e=a.map(function(a,c){return a?{x:c,y:a.positive/b}:{x:c,y:0}}),d=a.map(function(a,c){return a?{x:c,y:a.neutral/b}:{x:c,y:0}}),c=a.map(function(a,c){return a?{x:c,y:a.negative/b}:{x:c,y:0}})):(e=a.map(function(a,b){return{x:b,y:0}}),d=a.map(function(a,b){return{x:b,y:0}}),c=a.map(function(a,b){return{x:b,y:0}})),[c,d,e]},a.prototype.buildLayers=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;return null==b&&(b=null),f=this.findMax(a),e=this.buildWaves(a,f),d=d3.layout.stack().offset("wiggle")(e),i=0,k=d3.layout.stack().offset("wiggle"),null!=b?(g=k(this.buildWaves(b,f)),j=this.findMax(b),h=1-j/f,i=this.height*(h/2)):g=k(e),l=d3.scale.linear().domain([0,a.length]).range([0,this.width]),m=d3.scale.linear().domain([0,d3.max(d,function(a){return d3.max(a,function(a){return a.y0+a.y})})]).range([this.height,0]),c=d3.svg.area().x(function(a){return l(a.x)}).y0(function(a){return m(a.y0)}).y1(function(a){return m(a.y0+a.y)}).interpolate("basis"),{layers:g,area:c,offset:i}},a}()}.call(this),function(){var a,b;b=function(){function a(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;for(this.parent=a,this.data=b,this.width=c,this.height=d,this.radius=e,this.start=f,this.end=g,this.color=h,this.key=i,this.svg=this.parent.append("g").attr("transform","translate("+c/2+","+d/2+")").style({"pointer-events":"none"}),this.sticks=[],this.balls=[],this.texts=[],o=2*Math.PI/360,f=Math.PI/2*3,m=2*Math.PI*(1/720),z=this.data,l=v=0,x=z.length;x>v;l=++v)j=z[l],n=j.size*o,p=f+m+n/2,r=.3*Math.cos(p)*e,s=1.3*Math.cos(p)*e,t=.3*Math.sin(p)*e,u=1.3*Math.sin(p)*e,this.sticks[j.id]=this.svg.append("svg:line").attr({x1:r,y1:t,x2:s,y2:u}).style({stroke:"black","stroke-width":.3,"pointer-events":"none"}),this.balls[j.id]=this.svg.append("svg:ellipse").attr({cx:s,cy:u,rx:3,ry:3}).style({fill:"black","pointer-events":"none"}),q=s-5,0>s&&(q=s-13),this.texts[j.id]=this.svg.append("svg:text").attr({x:q,y:u+4,dx:"0.8em","text-anchor":0>s?"end":"start","data-id":j.id}).style({fill:"black"}).text(j.label),f+=n;for(A=this.data,l=w=0,y=A.length;y>w;l=++w)j=A[l],k=!1,(j.positive>0||j.negative>0||j.neutral>0)&&(k=!0),h=k?"black":"#cccccc",this.sticks[j.id].style("stroke",h),this.balls[j.id].style("fill",h),this.texts[j.id].style("fill",h)}return a}(),a=function(){function a(a,b,c,d,e,f,g,h,i){var j,k,l;this.parent=a,this.data=b,this.width=c,this.height=d,this.radius=e,this.start=f,this.end=g,this.color=h,this.key=i,this.innerRadius=this.radius-this.end,j=d3.svg.arc().outerRadius(this.radius-this.start).innerRadius(this.innerRadius),this.svg=this.parent.append("g").attr("transform","translate("+c/2+","+d/2+")").style({"pointer-events":"none"}),l=this.build_pie(),k=this.svg.selectAll(".arc").data(l).enter().append("g").attr("class","arc").style({"pointer-events":"none"}),k.append("path").style({fill:this.color,"pointer-events":"none"}).attr("d",j)}return a.prototype.build_pie=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(g=[],h=2*Math.PI/360,j=0,e=2*Math.PI*(1/720),m=this.data,d=k=0,l=m.length;l>k;d=++k)b=m[d],f=b.size*h,i=j+e,c=j+f-e,null!=this.key&&(a=b[this.key]/b.max*f,i=j+(f/2-a/2)+e,c=j+(f/2+a/2)-e),i>c&&(i=c),g.push({index:d,startAngle:i,endAngle:c,value:b[this.key],data:b,innerRadius:this.innerRadius}),j+=f;return g},a}(),window.Reticule=function(){function c(c,d,e){var f,g,h,i,j,k,l;for(this.parent=c,this.height=d,this.data=e,this.width=1.6*this.height,this.diameter=.5*this.height,this.svg=d3.select(this.parent).append("svg").attr("width",this.width).attr("height",this.height),j=.08*this.diameter,h=.01*this.diameter,k=h+h,i=[],f=l=0;2>=l;f=++l)i.push({start:k,end:k+j}),k+=j+h;g=this.diameter/2,new a(this.svg,this.data,this.width,this.height,g,0,k,"rgba(128,128,128,0.3)",null),this.p=new a(this.svg,this.data,this.width,this.height,g,i[0].start,i[0].end,"green","positive"),this.o=new a(this.svg,this.data,this.width,this.height,g,i[1].start,i[1].end,"#999999","neutral"),this.n=new a(this.svg,this.data,this.width,this.height,g,i[2].start,i[2].end,"red","negative"),this.labels=new b(this.svg,this.data,this.width,this.height,g)}return c}()}.call(this),function(){var a;a=function(){function a(a){var b,c,d;for(this.totalSlots=Math.floor(a),this.slots=[],b=c=0,d=this.totalSlots-1;d>=0?d>c:c>d;b=d>=0?++c:--c)this.slots.push(null)}return a.prototype.add=function(a,b){var c,d;if(a>this.totalSlots-1&&(a=this.totalSlots-1),null!=this.slots[a])for(a=c=a,d=this.totalSlots-1;(d>=a?d>c:c>d)&&this.slots[a];a=d>=a?++c:--c);return a===this.totalSlots-1&&null!=this.slots[a]&&this.crunch(),this.slots[a]=b},a.prototype.crunch=function(){var a,b,c,d;for(d=[],a=b=c=this.totalSlots-1;0>=c?0>b:b>0;a=0>=c?++b:--b){if(null==this.slots[a]){this.slots.splice(a,1);break}d.push(void 0)}return d},a.prototype.get=function(a){var b,c,d,e,f;for(b=0,f=this.slots,b=d=0,e=f.length;e>d;b=++d){if(c=f[b],c===a)return b;b+=1}return 0},a}(),window.ElegantWaves=function(){function b(a,b,c){this.parent=a,this.data=b,this.options=null!=c?c:{},this.setupOptions(),this.createContainer(),this.createXAxis(),this.createYScales(),this.createOrdering(),this.createColoring(),this.createSlotMap(),this.createFocus(),this.drawXAxis(),this.drawHilight(),this.drawMinMax(),this.drawSignals(),this.drawEvents()}return b.prototype.simplifyNumber=function(a){var b,c;return b="",Math.abs(a)>1e9&&(a/=1e9,b="B"),Math.abs(a)>1e6&&(a/=1e6,b="M"),Math.abs(a)>1e3&&(a/=1e3,b="K"),c=Math.floor(100*a)/100,""+c+b},b.prototype.createFocus=function(){var a,b,c,d=this;return this.focus={},this.yMap={},c=11,a=d3.bisector(function(a){return a.date}).left,b=this,this.mousemove=function(){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;r=[];for(i in b.focus){for(o=b.yscale[i],j=b.data[i],m=b.x.invert(d3.mouse(this)[0]),h=a(j,m,1),f=j[h-1],g=j[h],void 0===g&&(g=j[h-1]),e=m-f.date>g.date-m?g:f,p=0,l=null,k=!1,q=6,d=function(){var a,d,f,g,h;l=p,g=b.yMap,h=[];for(a in g){if(d=g[a],a===i)break;h.push(function(){var a;for(a=[];;)if(f=Math.abs(d-(o(e.value)+p)),o(e.value)+p<q&&(k=!0),c>f&&k===!0)a.push(p+=c-f);else{if(!(c>f))break;a.push(p-=c-f)}return a}())}return h},d();l!==p;)d();b.yMap[i]=o(e.value)+p,n=new Date(e.date).getTime()===b.max_date.getTime()?-5.9*e.value.toString().length-7:9,b.focus[i].attr("transform","translate("+b.x(e.date)+","+(o(e.value)+p)+")"),b.focus[i].select("text").attr("x",n),r.push(b.updateFocus(i,e))}return r},this.mouseover=function(){var a,b;b=[];for(a in d.focus)b.push(d.focus[a].style("display",null));return b},this.mouseout=function(){var a,b;b=[];for(a in d.focus)b.push(d.focus[a].style("display","none"));return b}},b.prototype.updateFocus=function(a,b){return this.focus[a].select("text").text(this.formatFocusNumber(b.value))},b.prototype.formatFocusNumber=function(a){return Math.round(100*a)/100},b.prototype.drawFocus=function(a){var b=this;return this.focus[a].append("circle").attr("r",3.5).style("stroke",function(){return b.color(a)}).style("fill","none"),this.focus[a].append("text").attr("x",9).attr("y",0).attr("dy",".35em")},b.prototype.createFocusFor=function(a){return this.focus[a]=this.svg.append("g").attr("class","focus").style("display","none"),this.drawFocus(a),this.svg.append("rect").attr("width",this.options.width).attr("height",this.options.height).style({fill:"none","pointer-events":"all"}).on("mouseover",this.mouseover).on("mouseout",this.mouseout).on("mousemove",this.mousemove)},b.prototype.drawMinMax=function(){return this.svg.append("text").attr("transform","translate("+(this.x(this.max_date)+190)+",0)").attr("x",3).attr("y",-10).style("fill","black").style("font-weight","bold").text(this.options.text.max),this.svg.append("text").attr("transform","translate("+(this.x(this.max_date)+130)+",0)").attr("x",3).attr("y",-10).style("fill","black").style("font-weight","bold").text(this.options.text.min)},b.prototype.setupOptions=function(){return null==this.options.margin&&(this.options.margin={top:20,right:250,bottom:30,left:0}),null==this.options.width&&(this.options.width=600),null==this.options.height&&(this.options.height=200),null==this.options.text&&(this.options.text={}),null==this.options.text.min&&(this.options.text.min="Min"),null==this.options.text.max?this.options.text.max="Max":void 0},b.prototype.createContainer=function(){return this.svg=d3.select(this.parent).append("svg").attr("class","elegant-waves").attr("width",this.options.width+this.options.margin.left+this.options.margin.right).attr("height",this.options.height+this.options.margin.top+this.options.margin.bottom).append("g").attr("transform","translate("+this.options.margin.left+","+this.options.margin.top+")")},b.prototype.drawXAxis=function(){var a;return a=d3.svg.axis().ticks(5).scale(this.x).orient("bottom"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.options.height+")").call(a)},b.prototype.drawHilight=function(){return(null!=this.options.hilightstart)>0?this.svg.append("rect").attr("x",this.x(this.options.hilightstart)).attr("width",this.x(this.options.hilightend)-this.x(this.options.hilightstart)).attr("y",0).attr("height",this.options.height).style({fill:"black","fill-opacity":"0.2"}):void 0},b.prototype.createXAxis=function(){return this.determineMinMaxDates(),this.x=d3.time.scale().range([0,this.options.width]),this.x.domain([this.min_date,this.max_date])},b.prototype.createYScales=function(){var a,b,c,d,e;for(this.yscale={},d=d3.keys(this.data),e=[],b=0,c=d.length;c>b;b++)a=d[b],this.yscale[a]=d3.scale.linear().range([this.options.height-3,4]),e.push(this.yscale[a].domain(d3.extent(this.data[a],function(a){return a.value})));return e},b.prototype.eventStyle=function(a){return{stroke:1===a.priority?"red":"orange","stroke-width":"4","stroke-opacity":"0.5"}},b.prototype.eventAttributes=function(a){return{"data-original-title":""+a.date+": "+a.subject,"data-placement":"bottom","data-toggle":"tooltip","data-container":"body","class":"line-tooltip"}},b.prototype.eventClick=function(){},b.prototype.renderEvent=function(a,b){var c=this;return this.svg.append("line").datum(a).attr("x1",b).attr("x2",b).attr("y1",0).attr("y2",this.options.height).attr(this.eventAttributes(a)).style(this.eventStyle(a)).on("click",function(a){return c.eventClick(a)})},b.prototype.drawEvents=function(){var a,b,c,d,e,f;if(null!=this.options.events){for(e=this.options.events,f=[],c=0,d=e.length;d>c;c++)a=e[c],b=this.x(a.date),f.push(a.date<=this.max_date&&b>=0?this.renderEvent(a,this.x(a.date)):void 0);return f}},b.prototype.createOrdering=function(){var a=this;return this.ordered=d3.keys(this.data),this.ordered=this.ordered.sort(function(b,c){var d,e;return d=a.yscale[b](a.data[b][a.data[b].length-1].value),e=a.yscale[c](a.data[c][a.data[c].length-1].value),d>e})},b.prototype.createColoring=function(){return this.color=d3.scale.category10(),this.color.domain(d3.keys(this.data))},b.prototype.determineMinMaxDates=function(){var a,b,c,d,e,f,g,h,i;for(this.max_date=new Date,this.min_date=new Date,h=d3.keys(this.data),d=0,f=h.length;f>d;d++)for(c=h[d],i=this.data[c],e=0,g=i.length;g>e;e++)a=i[e],a.date<this.min_date&&(this.min_date=a.date);return this.options.daterange?(b=this.options.daterange+30,this.min_date=this.max_date-24*b*60*60*1e3):void 0},b.prototype.drawMinMaxNumbers=function(a,b){var c,d,e,f=this;return e=this.data[a],d=Math.floor(d3.min(e,function(a){return a.value})),c=Math.floor(d3.max(e,function(a){return a.value})),this.svg.append("text").datum(function(){return{name:a,value:e[e.length-1]}}).attr("transform",function(){return"translate("+(f.x(f.max_date)+130)+","+b+")"}).attr("x",3).attr("dy",".35em").style("fill",function(){return f.color(a)}).text(this.simplifyNumber(d)),this.svg.append("text").datum(function(){return{name:a,value:e[e.length-1]}}).attr("transform",function(){return"translate("+(f.x(f.max_date)+190)+","+b+")"}).attr("x",3).attr("dy",".35em").style("fill",function(){return f.color(a)}).text(this.simplifyNumber(c))},b.prototype.drawVector=function(a){var b,c,d,e=this;return c=this.data[a],d=this.yscale[a],b=d3.svg.line().interpolate("monotone").x(function(a){return e.x(a.date)}).y(function(a){return d(a.value)}),this.svg.append("path").datum(c).attr("class","line").style("fill","none").attr("d",b).style("stroke",function(){return e.color(a)}).style("stroke-width",1)},b.prototype.createSlotMap=function(){var b,c,d,e,f,g,h;for(this.yBoxSize=15,this.slotMap=new a(this.options.height/this.yBoxSize+1),g=this.ordered,h=[],e=0,f=g.length;f>e;e++)b=g[e],c=this.data[b],d=Math.floor(this.yscale[b](c[c.length-1].value)/this.yBoxSize),h.push(this.slotMap.add(d,b));return h},b.prototype.drawSignalText=function(a,b){var c,d=this;return c=this.data[a],this.svg.append("text").datum(function(){return{name:a,value:c[c.length-1]}}).attr("transform",function(){return"translate("+d.x(d.max_date)+","+b+")"}).attr("x",3).attr("dy",".35em").style("fill",function(){return d.color(a)}).text(""+a)},b.prototype.drawSignals=function(){var a,b,c,d,e,f;for(e=this.ordered,f=[],c=0,d=e.length;d>c;c++)a=e[c],this.drawVector(a),b=this.slotMap.get(a)*this.yBoxSize,this.createFocusFor(a),this.drawSignalText(a,b),f.push(this.drawMinMaxNumbers(a,b));return f},b}()}.call(this),function(){angular.module("visualizations",[]).directive("sentimentwave",function(){return{restrict:"E",scope:{wave:"=",subwave:"=?",width:"@?",height:"@?"},template:"<div></div>",link:function(a,b){var c;return $(b).empty(),c=new window.SentimentWave($(b)[0],a.width?a.width:800,a.height?a.height:100,a.wave),a.subwave?c.subwave(a.subwave):void 0}}}).directive("reticule",function(){return{restrict:"E",scope:{data:"=",size:"@?"},template:"<div></div>",link:function(a,b){var c;return $(b).empty(),c=new window.Reticule($(b)[0],a.size?a.size:250,a.data)}}}).directive("elegantwaves",function(){return{restrict:"E",scope:{data:"=",options:"=?",size:"@?"},template:"<div></div>",link:function(a,b){var c;return $(b).empty(),c=new window.ElegantWaves($(b)[0],a.data,a.options)}}})}.call(this),angular.module("labsVisualizationsApp",["visualizations"]).controller("MainCtrl",["$scope",function(a){for(var b=[],c=[],d=0;500>d;d++){var e=200*Math.sin(d/20)+20;b.push({positive:Math.abs(.3*e),negative:Math.abs(.2*e),neutral:Math.abs(.5*e)});var e=50*Math.sin(d/20)+5;c.push({positive:Math.abs(.3*e),negative:Math.abs(.2*e),neutral:Math.abs(.5*e)})}a.firstwave=b,a.subwave=c,a.reticule_data=[{label:"a",id:"3",negative:0,positive:1,neutral:1,size:13.801670593274793,max:3},{label:"b",id:"6",negative:0,positive:0,neutral:0,size:14.139001927607625,max:3},{label:"c",id:"7",negative:0,positive:0,neutral:0,size:16.635253801670594,max:2},{label:"d",id:"9",negative:0,positive:0,neutral:0,size:16.635253801670594,max:2},{label:"e",id:"42",negative:0,positive:1,neutral:2,size:21.965088884129365,max:4},{label:"f",id:"29",negative:0,positive:0,neutral:2,size:24.5288070250589,max:3},{label:"g",id:"47",negative:0,positive:4,neutral:0,size:25.810666095523665,max:5},{label:"h",id:"54",negative:0,positive:1,neutral:2,size:26.013064896123367,max:5},{label:"h",id:"41",negative:0,positive:0,neutral:2,size:26.147997429856503,max:6},{label:"j",id:"98",negative:0,positive:1,neutral:3,size:27.429856500321268,max:6},{label:"k",id:"53",negative:0,positive:1,neutral:1,size:31.07303491111587,max:7},{label:"l",id:"30",negative:1,positive:4,neutral:3,size:33.77168558577854,max:7},{label:"m",id:"8",negative:1,positive:5,neutral:3,size:33.77168558577854,max:5},{label:"n",id:"2",negative:1,positive:4,neutral:3,size:48.276932962090385,max:8}];for(var f=function(a){return 864e5*a},g={a:[],b:[],c:[]},h=new Date,i=100;i>=0;i--){var j=h-f(i);g.a.push({date:j,value:Math.abs(70*Math.cos((100-i)/5))}),g.b.push({date:j,value:Math.abs(100*Math.cos((100-i)/8))}),g.c.push({date:j,value:Math.abs(80*Math.cos((100-i)/25))})}a.signals=g,a.signals_options={events:[{date:h-f(10),subject:"A",priority:1},{date:h-f(12),subject:"B",priority:2},{date:h-f(24),subject:"C",priority:1},{date:h-f(39),subject:"D",priority:2},{date:h-f(72),subject:"E",priority:1}]}}]);