"use strict";angular.module("labsVisualizationsApp",[]),function(){window.SentimentWave=function(){function a(a,b,c,d){var e,f=this;this.parent=a,this.width=b,this.height=c,this.data=d,e=this.buildLayers(this.data),this.svg=d3.select(this.parent).append("svg").attr("width",this.width).attr("height",this.height),this.colors=["#ff6666","#aaaaaa","#66ff66"],this.svg.selectAll("path.main").data(e.layers).enter().append("path").attr({d:e.area,"class":"main"}).style("fill",function(a,b){return f.colors[b]})}return a.prototype.subwave=function(a){var b,c=this;return b=this.buildLayers(this.data,a),this.svg.selectAll("path.main").style("opacity",.2),this.svg.selectAll("path.subwave").data(b.layers).enter().append("path").attr({d:b.area,"class":"subwave"}).attr("d",b.area).attr("transform","translate(0,-"+b.offset+")").style({fill:function(a,b){return c.colors[b]},opacity:1})},a.prototype.findMax=function(a){var b,c,d,e;for(c=0,d=0,e=a.length;e>d;d++)b=a[d],null!=b&&(b.positive>c&&(c=b.positive),b.neutral>c&&(c=b.neutral),b.negative>c&&(c=b.negative));return c},a.prototype.buildWaves=function(a,b){var c,d,e;return e=[],d=[],c=[],0!==b?(e=a.map(function(a,c){return a?{x:c,y:a.positive/b}:{x:c,y:0}}),d=a.map(function(a,c){return a?{x:c,y:a.neutral/b}:{x:c,y:0}}),c=a.map(function(a,c){return a?{x:c,y:a.negative/b}:{x:c,y:0}})):(e=a.map(function(a,b){return{x:b,y:0}}),d=a.map(function(a,b){return{x:b,y:0}}),c=a.map(function(a,b){return{x:b,y:0}})),[c,d,e]},a.prototype.buildLayers=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;return null==b&&(b=null),f=this.findMax(a),e=this.buildWaves(a,f),d=d3.layout.stack().offset("wiggle")(e),i=0,k=d3.layout.stack().offset("wiggle"),null!=b?(g=k(this.buildWaves(b,f)),j=this.findMax(b),h=1-j/f,i=this.height*(h/2)):g=k(e),l=d3.scale.linear().domain([0,a.length]).range([0,this.width]),m=d3.scale.linear().domain([0,d3.max(d,function(a){return d3.max(a,function(a){return a.y0+a.y})})]).range([this.height,0]),c=d3.svg.area().x(function(a){return l(a.x)}).y0(function(a){return m(a.y0)}).y1(function(a){return m(a.y0+a.y)}).interpolate("basis"),{layers:g,area:c,offset:i}},a}()}.call(this),function(){angular.module("visualizations",[]).directive("subwave",function(){return{restrict:"E",scope:{wave:"=",subwave:"=?",width:"@?",height:"@?"},template:"<div></div>",link:function(a,b){var c;return $(b).empty(),c=new window.SentimentWave($(b)[0],a.width?a.width:800,a.height?a.height:100,a.wave),a.subwave?c.subwave(a.subwave):void 0}}})}.call(this),angular.module("labsVisualizationsApp",["visualizations"]).controller("MainCtrl",["$scope",function(a){for(var b=[],c=[],d=0;500>d;d++){var e=200*Math.sin(d/20)+20;b.push({positive:Math.abs(.3*e),negative:Math.abs(.2*e),neutral:Math.abs(.5*e)});var e=50*Math.sin(d/20)+5;c.push({positive:Math.abs(.3*e),negative:Math.abs(.2*e),neutral:Math.abs(.5*e)})}a.firstwave=b,a.subwave=c}]);